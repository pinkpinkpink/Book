CPU

存储器

I/O

机器语言0、1

编译程序、解释程序

存储容量 = 存储单元个数 x 存储字长

- AI

    - 模式识别
    
    - 文字识别、语言翻译
    
- 存储器

   < 速度、容量、每位价格
   
   Cache 主存映射地址
   
   First-In-First-Out算法
   
   Least Recently Used算法
   
   
   硬磁盘存储器是计算机系统中最主要的外存设备。
   
- 输入输出系统

   I/O

## 第三章 中央处理器

- CPU

    定点数
    
    浮点数：小数点位置可以浮动的数
    
    - 加法与减法运算
    
    计算机的运算方法

    补码作加减运算

    一个负数可用他的正补数来代替，正数的补数是该正数本身。

    反码：有原码求补码或由补码求原码的中间过渡。

    整数、小数：[A]补+[B]补= [A+B]补
    
    【A-B】= [A]补 + [-B]补
    
    补码乘法
    
    浮点乘除法
    
    寻址：确定本条指令的数据地址以及下一条将要执行的指令地址的方法
    
    指令寻址：顺序寻址和跳跃寻址
    
    数据寻址

    6.5算术逻辑单元

    ALU电路

    指令系统 Page300
    
控制单元


    外存
    
    硬盘存储器：
    
    > 主机 
        磁盘存储器
        磁盘控制器
        盘片
        
        
磁盘存储容量

    > C = n x k x s;
    
    C 存储总容量
    
    n 存放信息的盘面数
    
    k 每个盘面的磁道数
    
    s 每个磁道上记录的二进制代码数
    
数据传输速率

    >   每一条磁道容量 x 磁盘转速
    
    
   
   cpu + 主存 = 主机


- CPU

无符号数和有符号数

0表示正

1表示负

机器数： 符号“数字化”的数

真值： 带 “+”“-”的数

反码： 原码求补码

移位

- Chapter 7 指令系统

1.指令由操作码和地址码组成

2.指令字长取决于操作码的长度、操作数地址的长度和操作数地址的个数

3.操作数类型

（1）地址无符号的整数

（2）数字

（3）字符

（4）逻辑数据 n个0和1的数字组合

7.2.2 数据在存储器中存放形式

数据存放在寄存器或存储器中，寄存器的位数可以反应机器字长，为了便于硬件实现，多字节的数据在存储器的存放方式满足“边界对准”

7.2.3操作类型

（1）数据传送

数据传送包括寄存器与寄存器、寄存器与逻辑单元、逻辑单元与逻辑单元之间的传送。

（2）算数逻辑操作

（3）移位

    算数移位、逻辑移位、循环移位

（4）转移

（5）输入输出指令

## 7.3 寻址方式

    寻址方式是本条指令的数据地址到下条将要执行的指令地址的方式

- 数据寻址

    操作数的真实地址为有效地址

    - 立即寻址

        操作数本身在地址内，指令中的形式地址不是操作数的地址

    - 直接寻址

        指令中的形式地址就是真实地址

- 指令寻址

    - 顺序寻址

    - 跳跃寻址

7.5 RISC技术

    指令精简技术(Reduced Instruction Set Computer)

    变址寻址和相对寻址

## Chapter8 CPU的结构和功能 Page338


- 第八讲 
运算方法和运算器

定点乘法运算

补码的一位乘法
补码比较算法
（1）符号位参加运算
（2）

存储器层次结构
编址方式
随机存储 DRAM cahe
顺序存储 磁带
直接存储 磁盘
相连存储 内容检索

存储介质
读写
    只读
    读写

内存、缓存

CPU寄存器 指令寄存器
高速缓存Cache
主存 内存
外存

外存储器 <程序 数据> 内存储器 <硬件> CPU

主存的结构 


# 计算机组成原理 南京大学

## 计算机系统概论

计算机系统 = 计算机硬件+计算机软件（=程序和相关的数据）

### 冯-诺伊曼结构

    存储程序

    二进制（指令和数据）

    运算器、控制器、存储器、输入、输出五大部分组成。

### 现代计算机模型

CPU —— 数据处理（运算器）控制（控制器）

存储器 —— 数据存储

I/O模块 —— 数据传送

- 计算机是如何工作的？（做菜）

     程序由指令组成（菜单由菜谱组成）

程序执行前
数据 指令 按序 存储器 存储单元地址
程序执行后
PC取指令（OP ADDR）

指令编译

取操作数

指令执行

回写结果

修改PC值

执行下一条指令

指令和数据

操作码

### 从机器语言到高级编程语言



- 机器语言 二进制

    所有信息都是0/1序列！

- 汇编语言 符号表示
    
    符号表示跳转位置和变量位置

    机器不认识指令？

- 高级语言

     面向算法描述

     面向过程面向对象

     编译 目标程序

     解释 

### 程序开发和执行及其支撑环境

程序转换处理过程
 
    hello.c （预处理ccp）hello.i (编译cc1) hello.s 汇编 

 程序数据流动过程

    $ ./hello

    存储部件

 不同层次语言之间的等价转换

    编译程序 汇编语言 指令译码器

开发与运行程序的支撑

编译

解释

语言处理程序+运行系统+操作系统内核+指令体系结构+计算机硬件+人机接口

操作系统和语言处理系统

### 现代计算机系统层次结构
“如何做”
“做什么”

应用程序
语言处理系统
操作系统
指令集体系结构
计算机硬件

应用（用户）

算法 （程序员）
编程
操作系统/虚拟机 （指令直接对硬件进行编程控制）

指令集体系结构ISA  最重要的层次 （系统程序员）
功能部件    （架构师）
电路    （电子工程师）
器件


Instruction Set Architecture 规定了如何使用硬件
    
    指令格式、操作种类

    寄存器的名称、编号、长度、用途

    存储空间的大小和编址方式

    寻址方式

    没有ISA，软件无法使用计算机硬件

## 计算机性能评价 **重点**

芯片

圆晶

Integrated Circuits Costs

Time to do the task

response time

execution time
 
latency

Tasks per day,hour,sec

throughput

bandwidth

CPU**执行时间**来衡量

用户CPU时间 —— CPU性能

系统CPU时间

Cycles Per Instruction

== CPU时钟周期数/程序 X 

Architure = Instrtion Set Arch + Organization Computer Design

### 系统总线

#### 总线基本概念

     总线用来互连，与其他部件的输入/出信息，部件之间架设通信线路

CPU——主存

主存——I/O

I/O——CPU

地址、数据、控制信息

CPU从主存取数据
CPU把结果数据送主存

#### 总线的分类

内部总线 芯片内部  数据

系统总线 CPU、存储器部件之间 数据、地址、控制信息

通信总线 主机和I/O设备之间

系统总线由控制、数据、地址线组成

#### 总线的特性和性能指标

一组电导线，在部件间共享传输信息。

物理机械特性

串行总线、并行总线

电气特性：

总线宽度：8、16、32、64
信号类型
定时方式
事物类型
工作频率（时钟频率）MHZ
总线带宽（最大传输速率）

处理器总线的带宽
==
每个时钟周期传输两次

I/O总线的带宽==（串行总线）


#### 总线结构

单总线结构

多总线结构

#### 总线裁决 

总线判优优控制：确定总线主控设备。

集中裁决方式：总线控制逻辑

菊花链查询：串行 2根裁决线
计数器定时查询：log2n根裁决线
独立请求：响应速度快、可编程、控制逻辑复杂、控制线很多 2n根裁决线
裁决算法：固定的并行判优算法、平等的循环菊花链算法、动态优先级算法（最近最少用算法、先来先服务算法）

分布裁决方式

总线裁决信号线

####  总线通讯控制

总线定时

总线通信控制何时开始何时结束

总线传输1.总线裁决2寻址阶段3.数据传输阶段4结束阶段

同步控制：时钟信号线 时钟周期  速度快 突发burst传输方式（突发长度）、接口逻辑少，传输速率=时钟频率X4
    按时间点约会
异步通信方式：没有公共的  握手协议（应答方式）
    按电话联系进行约会

    三条控制线：
    ReadReq：读请求
    DataRdy: 数据就绪
    Ack：回答
    总共7次握手包含两次应答，分别用来传输地址和数据
    - 非互锁
    - 半互锁
    - 全互锁

    对噪声敏感、接口逻辑复杂
半同步通信控制：时钟信号 就绪和应答
所有信号都有时钟信号决定

分离式通信控制
将传输事物分成两个子过程，提高总有效带宽


### 存储器

#### 存储器概述

1. 存储单元/编址单位 编制单位8位
2. 编址方式 字节编址 按字编址
3. 存储器地址寄存器：用于存放主存单元地址的寄存器
4. 存储器数据寄存器：用于存放主存单元中的数据的寄存器
分类：
1）性质：
1. 随机存取存储器RAM ：内存
2. 顺序 SAM ：磁带
3. 直接 DAM ：磁盘
4. 相联 CAM ：内容 块表
2）信息可更改性
1. 读写存储器 可读可写
2. 只读存储器 只能读不能写
3）断电后信息可保存性
1. 非易失性
信息一直保留 ROM、磁表面存储器、光存储器
2. 易失性
电源关闭信息自动丢失 RAM、Cache
4） 功能/速度/容量/所在位置
寄存器Register 封装在CPU中
高速缓存 Cache CPU内部 几MB
内存储器 MM CPU之外 DRAM 几GB
外存储器 AM 主机之外

- 内存和外存的关系

外存储器 存取速度慢、成本低、容量大，不与CPU直接连接，先传送到内存，然后才能被CPU使用。
内存储器 存取速度快，直接与CPU连接，CPU对内存中的指令和数据进行读、写操作，属于易失性存储器

主存的结构

主存存放指令和数据。CPU执行指令需要取指令、取数据、存数据时CPU会访问主存。
主存的地址空间是64GB。
- 主存性能指标
存取时间TA 

存储周期TMC 存取时间+下一存储时间开始附加时间

时间和存储容量（或带宽）

#### 半导体存储器

内存== 半导体存储芯片

RAM 随机存取

ROM 只读

读写原理  字线上
写1 低电平 放电
写0 高电平 充电

记忆单元Cell 存储器芯片Chip（+） 内存条

存储体

DRAM 4mX4 = 2048x2048x4 = 2 11 x 2(11)
11根分时复用

存储阵列  行列分时复用 容量增加4倍

DRAM芯片刷新周期 10ms - 100ms

#### 只读存储器ROM
随机存储
固定程序
MROM
P
Flash  闪存

编写0 擦除1 读0 读1
读快写慢

#### 主存与CPU的连接

1. CPU与存储器之间的通信方式

- 异步方式读操作需要握手信号

- 同步方式 SDRAM 
有确定的等待时间CL
连续传送Burst数据个数 BL = 1/2/4/8
多体交叉存取

2. 存储器芯片扩展

字扩展 位数不变，扩充容量

位扩展 字数不变，位数扩展

字位同时扩展 4倍

上述都是连续编址

主存地址

芯片内地址不连续，交叉编址，同时读写所有芯片。

存储器总线宽度为128位。
内存条

主存器物理结构 —— 内存条组成。

ROM 系统
RAM 用户
存储器和CPU速度差距越来越大。

- 提高存储器速度：
1. 芯片采用行缓存，行内数据直接从缓存取
2. 多模块技术：
    连续编址多模块存储器
    交叉编址            按低位地址划分模块 多个模块交叉存取
3. 引入Cache

#### 高速缓冲缓存器 Cache与程序访问的局部性

分层体系结构
复制传送 Block

程序访问局部化的特点！
时间局部性：
控件局部性：
原因：指令按序存放，地址连续

寄存器<1k
Cache
主存（RAM和ROM）
外存（硬盘和光盘）成批方式 Disk Cache磁盘高速缓存


数组在存储器按行优先顺序存放

Cache Block

Cache操作过程

Cache（高速缓存）的实现
如何分块
主存块和Cache如何映射
Cache和MM保持一致
Cache对程序员是透明的


#### Cache与主存之间的映射方式

Cache Mapping
- 直接映射：每个主存块映射到Cahce的固定行 Cache行号==主存块号 mod Cache行数Cache标记tag

唯一映射
主存标记7Cache槽号4块内地址9位
有效位：Valid Bit
开机复位 v=0
装入替换 v=1
冲刷Cache v=0
Cache索引
Cache标记Tag
块从0开始编号

- 全相联映射Cache组织：
任意映射；关联度最高
标记=主存块号11位 块内地址9位
按内容访问；无Cache索引；冲突缺失==0；27-bit
每行一个比较器

- 组相连映射
N-路映射
将Cache所有行分组 Cache组号=主存块号 mod Cache组数
cache组数==1，相联映射；每组一个槽，直接映射

#### cache替换算法

Hit Rate： 要访问的信息在Cache中

Miss Rate = 1- Hit Rate

替换算法 **没看懂**

- FIFO算法（先进先出）
    总是把最先进入的那一块淘汰掉
- 最近最少用（LRU）
    把最近最少用的那一块淘汰掉
    总是最长时间不看的书还回去。
- 最不经常用算法（LFU）
- 最近最多用算法（MRU）


#### Cache写策略和其他问题

写策略Cache一致性问题

写操作
写命中
write Through 同时写Cache和主存单元；写缓冲write Buffer（FIFO）
write Back 只写Cache不写主存

写不命中
写分配
    主存块装入Cache
非写分配

Cache大小和Block大小
Cache数目
多级Cache
L1Cache的命中时间比命中率更重要！
联合Cache
分立Cache

DRAM和Cache的传输单位是Block

#### 第九节 磁盘存储器

磁表面信息读出过程
写1 正向电流
写0 反向电流
磁盘的磁道（同心圆）和扇区（段512字节）
磁道的格式 索引脉冲开始 数据域 地址域 
磁盘格式化 填写ID域信息的过程
磁盘驱动器 控制电路+磁头+
磁盘数据地址 柱面号+磁头号+扇区号
平均存取时间

磁盘存储器=驱动器+控制器
驱动器逻辑结构：磁道号 磁头号 扇区号

#### 第十节 虚拟存储器的引入

存储器由OS管理
OS为进程分配存储器资源。
进程：
shell命令行
可执行文件
hello程序执行过程
OS的两个功能：
操作接口

存储管理

#### 虚拟存储器的实现

分页式系统
虚页号是页表项
页表结构：内存
每个进程都有页表，大小都一样
解决页表过大的问题
逻辑地址转换成物理地址的过程由页表来完成。


## 第五章 I/O系统

### I/O系统描述：输入输出系统

OS内核通过系统调用实现I/O.
I/O系统层次结构
用户空间的I/O软件
内核空间的I/O软件：
操作系统
I/O硬件


### 第二节 外部设备

输入设备
输出设备

人机交互
机器可读

输入输出设备
外部存储设备

I/O硬件建立外设和主机之间的通路

### 第三节 I/O接口

主机和外设的工作原理不、数据格式（串并转换）同

内部接口I/O总线接口

外部接口

I/O接口分类：

串行
并行

总线独占

可编程接口
不可编程接口

I/O接口的职能
数据缓冲：提供数据缓冲寄存器，匹配主机和外设工作速度
控制与定时

I/O设备寻址解决主机和外设通信是对“I/O端口”的寻址

I/O 端口的编址方式
统一编址：存储器映射方式
独立编址 Intel处理器 2 16个8位端口 IN OUT


### 第四节 程序直接控制方式

数据传送方式之一
查询方式
程序中断
直接存储器存储方式
1. 无条件传送（同步方式） I/O指令 用程序定时同步传送数据
2. 条件查询 （异步查询）查询程序

判断就绪和等待

### 程序中断控制方式

中断优先权排队和编码器
中断检测
中断响应
中断处理

多重中断
中断优先级

轮询方式和中断方式


#### DMA
DMA传送方式
交替分时访问
DMA控制器
地址寄存器
字寄存器
数据寄存器
设备地址寄存器
控制逻辑
DMA接口
请求
响应
修改主存地址
识别传送方向

DMA控制器预置
DMA数据传送
DMA处理结束


## 计算机的运算方式

### 整数的表示

数值数据
进位计数制
定/浮点表示
定点数表示
如何二进制编码
解决正负号
原码
补码
模运算：一个数与它除以模后的余数等价。

一个负数的补码==模减该负数的绝对值
模为2 n（次方）
定点整数：2n + X
定点小数：2 + X
补码的表示：
正数：符号位为0，数值部分不变
负数：符号位为1，数值部分“各位取反，末位加1”

变形补码：双符号，用于存放可溢出的中间结果。

求补码的真值：
符号为0，则为正数，数值部分同
符号为1，则为负数，数值各位取反，末位加1
移码表示浮点数阶码
高位到低位

### 浮点数表示

单精度
双精度
Binary
Decimal 2BH 2DH

### 非数值数据的编码表示

逻辑数据
表示：一位表示
N位二进制可表示N个逻辑数据
运算：按位进行
识别
位串
若干个状态位
256个字符

汉字
输入码：汉字对应按键编码用于输入 外码
内码：系统中进行存储、查找、传送  ASII码

Unicode
bit是计算机处理、存储、传输信息的最小单位
一个字节是8位
字长==数据通路的宽度
数据量的度量单位：
字节MB
带宽Mb

数据的存储和排列顺序
字的存放问题：
字的边界对齐方式：大端小端方式

字节交换问题
对齐问题：要求数据的地址是相应的边界地址
int
short
double
char
long

### 数据的校验
数据的检/纠错
冗余校验-校验位
码距

奇偶校验法，码距=2
海明校验：多重奇偶校验 2 k次方>=n+k

单纠错和双检错码
CRC码 大批量数据存储和传送 外存和通信
n+k位（CRC码）

### 计算机的运算概述

算术逻辑部件ALU 其核心是加法器。
串行加法器速度慢
并行进位加法器
加减与非 和移位器
1. 算术运算
2. 按位运算 位串
3. 逻辑运算
4. 移位运算
左移 << 溢出 高位移出，低位补0.
右移 >>
基本数据类型
无符号数、带符号整数、浮点数、位串、字符（串）

定点算术运算指令
逻辑运算指令

### 第六节 定点数运算及运算部件

补码的加减运算
移码的加减运算
乘法=加法+右移

### 定点除运算

补码除法


### 浮点数运算

MIPS
表示
单/双精度
对阶

浮点数加减运算

溢出

### 第七章 

#### 指令系统

基本寻址方式的算法和优缺点

偏移寻址方式
基址寻址实现程序重定位
相对寻址实现相对转移

